---
import Layout from "../../layouts/Layout.astro";
import Card from "../../components/Card.astro";
import Pagination from "../../components/Pagination.astro";
import { getCollection } from "astro:content";

export async function getStaticPaths({ paginate }) {
    const allArticles = await getCollection("articles");
    const categories = ["drama", "movie", "game", "anime", "novel"];

    return categories.flatMap((category) => {
        const filteredArticles = allArticles.filter(
            (article) => article.data.category === category,
        );
        const sortedArticles = filteredArticles.sort(
            (a, b) =>
                b.data.releaseDate.valueOf() - a.data.releaseDate.valueOf(),
        );

        return paginate(sortedArticles, {
            params: { category },
            pageSize: 20,
        });
    });
}

const { page } = Astro.props;
const { category } = Astro.params;
const title = category.charAt(0).toUpperCase() + category.slice(1);

const categoryDescriptions = {
    drama: "Discover the latest and most popular Chinese dramas, including reviews, cast info, and more.",
    movie: "Explore top-rated Chinese movies, from blockbusters to indie gems, with detailed insights.",
    game: "Stay updated with the newest Chinese video games, guides, and industry news.",
    anime: "Dive into the world of Chinese anime (Donghua) with recommendations and series overviews.",
    novel: "Read about trending Chinese novels, web fiction, and literary works.",
};

const baseDescription =
    categoryDescriptions[category] || `Browse our collection of ${title}.`;
const description =
    page.currentPage > 1
        ? `${baseDescription} - Page ${page.currentPage}`
        : baseDescription;
---

<Layout title={`OmniNav - ${title}`} description={description}>
    <h1>{title}</h1>
    <div class="grid">
        {page.data.map((article) => <Card article={article} />)}
    </div>

    <Pagination page={page} />
</Layout>

<style>
    h1 {
        margin-bottom: 2rem;
        text-transform: capitalize;
    }
    .grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
        gap: 2rem;
    }
</style>
